"use strict";(self.webpackChunkfront_financas=self.webpackChunkfront_financas||[]).push([[151],{3151:(J,h,o)=>{o.r(h),o.d(h,{ParcelaListaModule:()=>Z});var f=o(6895),u=o(4229),d=o(790);const b=[{property:"responsavelNome",label:"Respons\xe1vel"},{property:"mesReferencia",label:"M\xeas Refer\xeancia"},{property:"anoReferencia",label:"Ano Refer\xeancia"},{property:"parcelaAtual",label:"Parcela Atual"},{property:"quantidadeParcelas",label:"Quant. Parcelas"},{property:"valorParcelado",label:"Valor Parcelado",type:"currency",format:"BRL"}];var m=o(4607),a=o(4650),P=o(1481),l=o(8654),v=o(8095);const g={mesReferencia:{label:"M\xeas",value:void 0,object:void 0,property:"filtroParcelas",fLabel:i=>`${i.label}: ${i.value}`},anoReferencia:{label:"Ano",value:void 0,object:void 0,property:"filtroParcelas",fLabel:i=>`${i.label}: ${i.value}`},responsavelId:{label:"Respons\xe1vel",value:void 0,object:void 0,property:"filtroParcelas",fLabel:i=>`${i.label}: ${i.object}`}};var c=o(433),D=o(2424);const C=["filtroParcela"];let L=(()=>{class i{constructor(e,r){this.formBuilder=e,this.responsavelComboService=r,this.buscarNovosDados=new a.vpe(!0),this.buscarMaisDados=new a.vpe(!0),this.acaoFiltro={action:()=>{this.buscarNovosDadosComFiltros()},label:"Buscar"},this.filtrosParcelas=g}ngOnInit(){this.criarFormulario()}ngAfterViewInit(){this.filtroParcela.onXClosed.subscribe(()=>{this.formulario.patchValue(this.backupFormulario)})}criarFormulario(e){this.formulario=this.formBuilder.group({mesReferencia:[e?.mesReferencia],anoReferencia:[e?.anoReferencia],responsavelId:[e?.responsavelId],pesquisar:[e?.pesquisar]})}abrirFiltroParcela(){this.backupFormulario=this.formulario.getRawValue(),this.filtroParcela.open()}buscarMaisDadosComFiltros(){this.buscarDadosComFiltros(),this.buscarMaisDados.emit(this.filtrosParcelas)}buscarNovosDadosComFiltros(){this.buscarDadosComFiltros(),this.buscarNovosDados.emit(this.filtrosParcelas)}buscarDadosComFiltros(){this.filtroParcela.close(),this.processaFiltrosParcelas(this.formulario.getRawValue())}processaFiltrosParcelas(e){Object.entries(e).forEach(([r,s])=>{if(this.filtrosParcelas[r]){switch(r){case"mesReferencia":case"anoReferencia":case"responsavelId":this.filtrosParcelas[r].object=s;break;default:this.filtrosParcelas[r].value=s}this.filtrosParcelas[r].value=s}})}removerDisclaimer(e){this.limparCampo(e.removedDisclaimer.value[0]),this.processaFiltrosParcelas(this.formulario.getRawValue()),this.buscarNovosDados.emit(this.filtrosParcelas)}removerTodosDisclaimer(e){e.forEach(r=>{this.limparCampo(r.value[0])})}limparCampo(e){this.filtrosParcelas[e]&&this.formulario.get(e)?.reset()}static#a=this.\u0275fac=function(r){return new(r||i)(a.Y36(c.qu),a.Y36(D.G))};static#e=this.\u0275cmp=a.Xpm({type:i,selectors:[["app-filtro-parcela"]],viewQuery:function(r,s){if(1&r&&a.Gf(C,7),2&r){let t;a.iGM(t=a.CRH())&&(s.filtroParcela=t.first)}},outputs:{buscarNovosDados:"buscarNovosDados",buscarMaisDados:"buscarMaisDados"},decls:8,vars:3,consts:[["p-size","md","p-title","Busca avan\xe7ada Parcelas",3,"p-primary-action"],["filtroParcela",""],[3,"formGroup"],[1,"po-row"],["formControlName","mesReferencia","p-label","M\xeas de refer\xeancia",1,"po-md-6"],["formControlName","anoReferencia","p-label","Ano de refer\xeancia",1,"po-md-6"],["formControlName","responsavelId","p-label","Respons\xe1vel",1,"po-md-12",3,"p-filter-service"]],template:function(r,s){1&r&&(a.TgZ(0,"po-modal",0,1)(2,"form",2)(3,"div",3),a._UZ(4,"po-input",4)(5,"po-input",5),a.qZA(),a.TgZ(6,"div",3),a._UZ(7,"po-combo",6),a.qZA()()()),2&r&&(a.Q6J("p-primary-action",s.acaoFiltro),a.xp6(2),a.Q6J("formGroup",s.formulario),a.xp6(5),a.Q6J("p-filter-service",s.responsavelComboService))},dependencies:[l.ZZR,l.xxV,l.hmF,c._Y,c.JJ,c.JL,c.sg,c.u],encapsulation:2})}return i})(),T=(()=>{class i{transform(e){return null===e||isNaN(e)?"":new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e)}static#a=this.\u0275fac=function(r){return new(r||i)};static#e=this.\u0275pipe=a.Yjl({name:"formatterReal",type:i,pure:!0})}return i})();const A=["filtroParcelas"],R=["tabelaListaParcela"],F=["paginaListaParcela"];function _(i,p){1&i&&(a.TgZ(0,"span",11),a._uU(1,"ATIVO"),a.qZA())}function N(i,p){1&i&&(a.TgZ(0,"span",12),a._uU(1,"INATIVO"),a.qZA())}function y(i,p){if(1&i&&(a.TgZ(0,"div"),a.YNc(1,_,2,0,"span",9),a.YNc(2,N,2,0,"span",10),a.qZA()),2&i){const e=a.oxw().row;a.xp6(1),a.Q6J("ngIf",1==e.ativo),a.xp6(1),a.Q6J("ngIf",0==e.ativo)}}function I(i,p){1&i&&a.YNc(0,y,3,2,"div",8),2&i&&a.Q6J("ngIf","ativo"===p.column.property)}const M=[{path:"",component:(()=>{class i{constructor(e,r,s,t,n){this.router=e,this.titleService=r,this.poNotification=s,this.parcelaApiService=t,this.poDialog=n,this.nomePagina=m.bZ.label,this.colunasTabelaParcela=b,this.valorTotal="****",this.disclaimers=new Array,this.carregandoTabelaParcela=!1,this.carregandoDadosParcela=!1,this.desabilitarCarregarMais=!1,this.acoes=[{label:"Gerar valor total",action:this.gerarValorTotal.bind(this),icon:"po-icon-finance"}],this.paginacao={page:0},this.parcelaListaFilter={action:this.buscar.bind(this),advancedAction:this.abrirBuscaAvan\u00e7ada.bind(this),placeholder:"Pesquisar C\xf3digo ou Descri\xe7\xe3o",width:4},this.parcelaListaDisclaimer={title:"Filtros",disclaimers:[],remove:this.removerDisclaimer.bind(this),removeAll:this.removerTodosDisclaimer.bind(this)},this.parcelaListaAcoes=(0,d.L)(this.editarParcela.bind(this),this.removerParcelaDialog.bind(this))}ngAfterViewInit(){this.titleService.setTitle(`${this.nomePagina}`)}novaParcela(){this.router.navigate([m.v.link])}buscar(e){this.carregandoTabelaParcela=!0,this.filtroLista=e,this.limparItensParcelas(),this.popularDisclaimers(this.filtroParcela,this.filtroLista),this.buscarNovosDados(this.filtroParcela),this.carregandoTabelaParcela=!1}buscarNovosDados(e){this.limparItensParcelas(),this.buscarMaisDados(e)}buscarMaisDados(e){this.filtroParcela=e,this.popularDisclaimers(this.filtroParcela,this.filtroLista);const r=this.criarParametroParcela(this.filtroParcela,this.filtroLista);this.carregandoTabelaParcela=!0,this.parcelaApiService.buscarParcelas(r,this.paginacao.page).subscribe({next:s=>{this.tabelaListaParcela.sortColumn({}),this.listaParcelas=this.listaParcelas?[...this.listaParcelas,...s.content]:[...s.content],this.desabilitarCarregarMais=s.last},error:({error:s})=>{this.limparItensParcelas(),this.poNotification.error(s?.title?s.title:"Erro no servidor"),console.error(s)},complete:()=>{this.carregandoTabelaParcela=!1}})}popularDisclaimers(e,r){this.disclaimers=[],r&&this.disclaimers.push(this.processaFiltroLista(r)),e&&this.disclaimers.push(...this.processaFiltroParcelaAvancado(e)),this.parcelaListaDisclaimer.disclaimers=this.disclaimers&&this.disclaimers.length>0?[...this.disclaimers]:[]}processaFiltroLista(e){return{label:"Pesquisar: "+e,value:e,property:"filtroLista"}}processaFiltroParcelaAvancado(e){return Object.entries(e).filter(r=>Array.isArray(r[1]?.value)?!!r[1].value.length:r[1]?.value).map(r=>({label:r[1].fLabel(r[1]),value:r,property:r[1].property,hideClose:r[1].hideClose}))}criarParametroParcela(e,r){if(e||r)return{mesReferencia:e?.mesReferencia?.value,anoReferencia:e?.anoReferencia?.value,responsavelId:e?.responsavelId?.value,pesquisar:r}}limparItensParcelas(){this.paginacao.page=0,this.listaParcelas=[],this.desabilitarCarregarMais=!0}removerDisclaimer(e){switch(e.removedDisclaimer.property){case"filtroLista":this.paginaListaParcela.clearInputSearch(),this.buscar("");break;case"filtroParcelas":this.filtroParcelas.removerDisclaimer(e)}}removerTodosDisclaimer(e){this.paginaListaParcela.clearInputSearch(),this.filtroParcelas.removerTodosDisclaimer(e),this.listaParcelas=[]}editarParcela(e){this.router.navigate([(0,m.EI)(e.id).link])}removerParcelaDialog(e){this.poDialog.confirm({title:"Aten\xe7\xe3o",message:`Tem certeza que deseja remover a parcela?\n      <br>\n      <br> <b>C\xf3digo</b>: ${e.nome||""}`,confirm:()=>this.removerParcela(e)})}removerParcela(e){this.carregandoTabelaParcela=!0,this.parcelaApiService.deletarParcela(e.id).subscribe({next:()=>{this.filtroParcelas.buscarNovosDadosComFiltros(),this.poNotification.success("Removido com sucesso")},error:({error:r})=>{this.poNotification.error(r?.detail?r.detail:"Erro no servidor"),console.error(r)},complete:()=>{this.carregandoTabelaParcela=!1}})}mostrarMaisParcelas(){this.tabelaListaParcela.sortColumn({}),this.carregandoDadosParcela=!0,this.paginacao.page++,this.filtroParcelas.buscarMaisDadosComFiltros(),this.carregandoDadosParcela=!1}abrirBuscaAvan\u00e7ada(){this.filtroParcelas.abrirFiltroParcela()}gerarValorTotal(){const e=this.criarParametroParcela(this.filtroParcela,this.filtroLista);this.parcelaApiService.buscarValorTotal(e).subscribe({next:r=>{this.valorTotal=r},error:({error:r})=>{this.poNotification.error(r?.detail?r.detail:"Erro no servidor"),console.error(r)},complete:()=>{}})}static#a=this.\u0275fac=function(r){return new(r||i)(a.Y36(u.F0),a.Y36(P.Dx),a.Y36(l.fRI),a.Y36(v.C),a.Y36(l.Aw7))};static#e=this.\u0275cmp=a.Xpm({type:i,selectors:[["app-parcela-lista"]],viewQuery:function(r,s){if(1&r&&(a.Gf(A,7),a.Gf(R,7),a.Gf(F,7)),2&r){let t;a.iGM(t=a.CRH())&&(s.filtroParcelas=t.first),a.iGM(t=a.CRH())&&(s.tabelaListaParcela=t.first),a.iGM(t=a.CRH())&&(s.paginaListaParcela=t.first)}},inputs:{listaParcelas:"listaParcelas"},decls:11,vars:16,consts:[[3,"p-actions","p-title","p-filter","p-disclaimer-group"],["paginaListaParcela",""],[2,"width","100%"],[2,"width","100%",3,"p-actions","p-sort","p-striped","p-loading","p-loading-show-more","p-show-more-disabled","p-items","p-columns","p-actions-right","p-show-more"],["tabelaListaParcela",""],["p-table-cell-template",""],[3,"buscarMaisDados","buscarNovosDados"],["filtroParcelas",""],[4,"ngIf"],["class","po-color-10 po-table-column-label",4,"ngIf"],["class","po-color-07 po-table-column-label",4,"ngIf"],[1,"po-color-10","po-table-column-label"],[1,"po-color-07","po-table-column-label"]],template:function(r,s){1&r&&(a.TgZ(0,"po-page-list",0,1)(2,"h1"),a._uU(3),a.ALo(4,"formatterReal"),a.qZA(),a.TgZ(5,"po-container",2)(6,"po-table",3,4),a.NdJ("p-show-more",function(){return s.mostrarMaisParcelas()}),a.YNc(8,I,1,1,"ng-template",5),a.qZA()()(),a.TgZ(9,"app-filtro-parcela",6,7),a.NdJ("buscarMaisDados",function(n){return s.buscarMaisDados(n)})("buscarNovosDados",function(n){return s.buscarNovosDados(n)}),a.qZA()),2&r&&(a.Q6J("p-actions",s.acoes)("p-title",s.nomePagina)("p-filter",s.parcelaListaFilter)("p-disclaimer-group",s.parcelaListaDisclaimer),a.xp6(3),a.hij("Valor total: ",a.lcZ(4,14,s.valorTotal),""),a.xp6(3),a.Q6J("p-actions",s.parcelaListaAcoes)("p-sort",!0)("p-striped",!0)("p-loading",s.carregandoTabelaParcela)("p-loading-show-more",s.carregandoDadosParcela)("p-show-more-disabled",s.desabilitarCarregarMais)("p-items",s.listaParcelas)("p-columns",s.colunasTabelaParcela)("p-actions-right",!0))},dependencies:[f.O5,l.PJf,l.Ulp,l._w3,l.q5v,L,T],encapsulation:2})}return i})()}];let w=(()=>{class i{static#a=this.\u0275fac=function(r){return new(r||i)};static#e=this.\u0275mod=a.oAB({type:i});static#r=this.\u0275inj=a.cJS({imports:[u.Bz.forChild(M),u.Bz]})}return i})(),Z=(()=>{class i{static#a=this.\u0275fac=function(r){return new(r||i)};static#e=this.\u0275mod=a.oAB({type:i});static#r=this.\u0275inj=a.cJS({imports:[f.ez,l.JBz,c.UX,c.u5,w]})}return i})()}}]);