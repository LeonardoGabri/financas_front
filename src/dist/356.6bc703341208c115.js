"use strict";(self.webpackChunkfront_financas=self.webpackChunkfront_financas||[]).push([[356],{7356:(G,f,s)=>{s.r(f),s.d(f,{CompraFormModule:()=>P});var b=s(6895),n=s(433),p=s(8654),u=s(4229),d=s(1117),h=s(1147),g=s(8640),v=s(5151),e=s(4650),R=s(1481),N=s(7107),I=s(379),T=s(2004),Z=s(7960),S=s(5698),C=s(4004),J=s(2340),A=s(529);let L=(()=>{class i{listarTipoCompraEnum(){return this.http.get(`${this.pathApi}/enum/tipo-compra`).pipe((0,S.q)(1))}getFilteredData(a,r){return this.listarTipoCompraEnum().pipe((0,C.U)(t=>t?t.map(l=>({label:l.label,value:l.label})):[]))}getObjectByValue(a){return this.listarTipoCompraEnum().pipe((0,C.U)(r=>{const t=r.find(l=>l.value==a)||null;return{label:t.label,value:t.value||void 0}}))}constructor(a){this.http=a,this.pathApi=`${J.N.url.service}`}static#e=this.\u0275fac=function(r){return new(r||i)(e.LFG(A.eN))};static#a=this.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var E=s(2424);const F=["modalResponsavelCompra"];let Q=(()=>{class i{constructor(a,r,o){this.formBuilder=a,this.poNotification=r,this.responsavelComboService=o,this.atualizarFormulario=new e.vpe(!0),this.acao={action:()=>{this.salvar()},disabled:!0,label:"Salvar"}}ngOnInit(){this.criarFormulario(),this.formulario.statusChanges.subscribe(a=>{this.acao.disabled="INVALID"==a})}criarFormulario(a){this.formulario=this.formBuilder.group({indTabela:[a?.indTabela],id:[a?.id],responsavel:[a?.responsavel],responsavelNome:[a?.responsavelNome],percentual:[a?.percentual]})}abrirModalResponsavelCompra(a){this.limpar(),this.modalResponsavelCompra.open(),a&&this.formulario.patchValue(a)}fecharModalResponsavelCompra(){this.formulario.reset(),this.modalResponsavelCompra.close()}limpar(){this.formulario.reset(),this.formulario.markAsPristine()}salvar(){this.formulario.valid||this.poNotification.error("Formul\xe1rio inv\xe1lido"),this.responsaveis?.find(r=>r.id==this.formulario.get("id")?.value)?this.poNotification.error("Respons\xe1vel j\xe1 incluso na compra"):(this.atualizarFormulario.emit(this.formulario.getRawValue()),this.fecharModalResponsavelCompra())}alteraResponsavel(a){this.formulario.get("responsavel")?.setValue(a?.label)}static#e=this.\u0275fac=function(r){return new(r||i)(e.Y36(n.qu),e.Y36(p.fRI),e.Y36(E.G))};static#a=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-responsavel-compra"]],viewQuery:function(r,o){if(1&r&&e.Gf(F,7),2&r){let t;e.iGM(t=e.CRH())&&(o.modalResponsavelCompra=t.first)}},inputs:{responsaveis:"responsaveis"},outputs:{atualizarFormulario:"atualizarFormulario"},decls:7,vars:6,consts:[["p-size","xl","p-title","Respons\xe1vel da compra",3,"p-primary-action"],["modalResponsavelCompra",""],[3,"formGroup"],[1,"po-row"],["formControlName","id","p-label","Respons\xe1vel",1,"po-md-12",3,"p-filter-service","p-clean","p-required","p-emit-object-value","p-change"],["formControlName","percentual","p-label","Porcentagem da compra","p-clean","true","p-required","true","p-mask","999",1,"po-md-12"]],template:function(r,o){1&r&&(e.TgZ(0,"po-modal",0,1)(2,"form",2)(3,"div",3)(4,"po-combo",4),e.NdJ("p-change",function(l){return o.alteraResponsavel(l)}),e.qZA()(),e.TgZ(5,"div",3),e._UZ(6,"po-decimal",5),e.qZA()()()),2&r&&(e.Q6J("p-primary-action",o.acao),e.xp6(2),e.Q6J("formGroup",o.formulario),e.xp6(2),e.Q6J("p-filter-service",o.responsavelComboService)("p-clean",!0)("p-required",!0)("p-emit-object-value",!0))},dependencies:[p.ZZR,p.dZS,p.hmF,n._Y,n.JJ,n.JL,n.sg,n.u],encapsulation:2})}return i})();const y=["modalResponsavelCompra"],q=["tabelaResponsavel"];function D(i,H){if(1&i&&(e.TgZ(0,"div",2),e._UZ(1,"po-decimal",21)(2,"po-decimal",22),e.qZA()),2&i){const a=e.oxw();e.xp6(1),e.Q6J("p-disabled",a.somenteLeitura.toString())}}const M=function(){return[]},z=[{path:"",component:(()=>{class i{constructor(a,r,o,t,l,m,c,Y,j,B,U){this.formBuilder=a,this.route=r,this.router=o,this.poDialogService=t,this.poNotification=l,this.titleService=m,this.compraApiService=c,this.bancoComboService=Y,this.fornecedorComboService=j,this.subgrupoComboService=B,this.tipoCompraEnumComboService=U,this.nomePrincipal=d.I.label,this.somenteLeitura=!1,this.colunasResponsavelCompra=g.V,this.acoesLista=[{action:this.editarModalResponsavelCompra.bind(this),icon:"po-icon po-icon-edit",label:"Editar"},{action:this.removerResponsavelDialog.bind(this),icon:"po-icon po-icon-delete",label:"Remover"}],this.acoes=[{action:()=>{this.salvar()},disabled:!1,label:"Salvar"},{action:()=>{this.cancelar()},disabled:!1,label:"Cancelar"}],this.navegacao={items:[{label:this.nomePrincipal,action:this.verificarFormulario.bind(this)}]}}ngOnInit(){this.criarFormulario(),this.route.params.subscribe(a=>{a&&a.id?this.compraApiService.buscarCompraPorId(a.id).subscribe({next:r=>{r&&(this.router.url.includes("visualizar")?(this.nomePagina=(0,v.gD)(a.id).label,this.acoes[0].disabled=!0,this.somenteLeitura=!0):this.nomePagina=(0,v.U1)(a.id).label,this.formulario.patchValue(r))},error:({error:r})=>{this.poNotification.error(r?.title?r.title:"Erro no servidor"),console.error(r)},complete:()=>{this.navegacao.items.push({label:this.nomePagina}),this.titleService.setTitle(`${this.nomePagina} - Motor Fiscal`)}}):(this.nomePagina=v.Kc.label,this.navegacao.items.push({label:this.nomePagina}),this.titleService.setTitle(`${this.nomePagina} - Motor Fiscal`))}),this.formulario.valueChanges.subscribe({next:a=>{let r=a.valor,o=a.aliquotaImposta,t=this.formulario.get("valorImposto")?.value;if(o&&r){let l=o*r;l!==t&&this.formulario.get("valorImposto")?.setValue(l)}else null!==t&&this.formulario.get("valorImposto")?.reset()},error:({error:a})=>{console.error(a)}})}criarFormulario(a){this.formulario=this.formBuilder.group({id:[a?.id],banco:[a?.banco],bancoNome:[a?.bancoNome],fornecedor:[a?.fornecedor],fornecedorNome:[a?.fornecedorNome],dataCompra:[a?.dataCompra],subgrupo:[a?.subgrupo],subgrupoNome:[a?.subgrupoNome],parcelas:[a?.parcelas],valor:[a?.valor],mesInicioCobranca:[a?.mesInicioCobranca],anoInicioCobranca:[a?.anoInicioCobranca],responsaveis:[a?.responsaveis],descricao:[a?.descricao],tipoCompra:[null==a?.tipoCompra?"EFETIVO":a?.tipoCompra],aliquotaImposta:[a?.aliquotaImposta||0],valorImposto:[a?.valorImposto||0]})}verificarFormulario(a,r=[d.I.link],o=this.formulario){(0,h.TR)(r,o,this.router,this.poDialogService)}cancelar(){this.verificarFormulario()}salvar(){this.formulario.markAsPristine();let a=this.formulario.get("responsaveis")?.value,r=0;if(Array.isArray(a)&&a.forEach(o=>{r+=o.percentual}),100!=r&&this.poNotification.error("Divis\xe3o do percentual da compra diferente de 100%"),this.formulario.valid){let o=this.formulario.getRawValue();o.aliquotaImposta=null==o.aliquotaImposta?0:o.aliquotaImposta,o.valorImposto=null==o.valorImposto?0:o.valorImposto;let t=o.id;delete o.id;let l=t?this.compraApiService.editarCompra(t,o):this.compraApiService.salvarCompra(o);this.acoes[0].disabled=!0,this.poNotification.information("Criando Parcelas"),l.subscribe({next:m=>{m&&(this.poNotification.success("Salvo com sucesso"),this.router.navigate([d.I.link]))},error:({error:m})=>{this.acoes[0].disabled=!1;let c={message:m?.title?m.title:"Erro no servidor",action:()=>{},actionLabel:""};m?.detail&&(c.action=()=>{this.poDialogService.alert({title:m?.title,message:m?.detail,ok:()=>!0})},c.actionLabel="Detalhes"),this.poNotification.error(c),console.error(m)},complete:()=>{this.acoes[0].disabled=!1}})}else(0,h.DD)(this.formulario),this.poNotification.error("Erro no formul\xe1rio"),this.acoes[0].disabled=!1}abrirModalResponsavelCompra(){this.modalResponsavelCompra.abrirModalResponsavelCompra()}editarModalResponsavelCompra(a){this.modalResponsavelCompra.abrirModalResponsavelCompra(a)}removerResponsavelDialog(a){this.poDialogService.confirm({title:"Aten\xe7\xe3o",message:`Tem certeza que deseja remover respons\xe1vel?\n        <br>\n        <b>Nome: </b> ${a.responsavel}\n      `,confirm:()=>this.removerResponsavel(a)})}removerResponsavel(a){if(null==a.indTabela)return;let r=this.formulario.get("responsaveis")?.value||new Array;r=r.filter(o=>o.indTabela!=o.indTabela),this.setaIndTabela(r)}setaIndTabela(a){a?.forEach((r,o)=>{r.indTabela=o}),this.formulario.get("responsaveis")?.setValue(a),this.tabelaResponsavel.items=a}atualizarFormulario(a){let r=this.formulario.get("responsaveis")?.value||new Array;if(null==a.indTabela)r?.push(a);else{let o=r.findIndex(function(t){return t.indTabela==t.indTabela});-1!=o&&(r[o]=a)}this.setaIndTabela(r)}dataHoraAlterada(a){let r=this.formulario.get("dataCompra");r?.value!=a&&r?.setValue(a)}alteraBanco(a){this.bancoNome=a.label,this.formulario.get("bancoNome")?.setValue(this.bancoNome),"DINHEIRO"!=a.label&&this.formulario.get("aliquotaImposta")?.reset()}alteraFornecedor(a){this.formulario.get("fornecedorNome")?.setValue(a.label)}alteraSubgrupo(a){this.formulario.get("subgrupoNome")?.setValue(a.label)}static#e=this.\u0275fac=function(r){return new(r||i)(e.Y36(n.qu),e.Y36(u.gz),e.Y36(u.F0),e.Y36(p.Aw7),e.Y36(p.fRI),e.Y36(R.Dx),e.Y36(N.S),e.Y36(I.m),e.Y36(T.B),e.Y36(Z.M),e.Y36(L))};static#a=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-compra-form"]],viewQuery:function(r,o){if(1&r&&(e.Gf(y,7),e.Gf(q,7)),2&r){let t;e.iGM(t=e.CRH())&&(o.modalResponsavelCompra=t.first),e.iGM(t=e.CRH())&&(o.tabelaResponsavel=t.first)}},decls:31,vars:44,consts:[[3,"p-title","p-breadcrumb","p-actions"],[3,"formGroup"],[1,"po-row"],["formControlName","banco","p-label","Banco",1,"po-md-6",3,"p-filter-service","p-disabled","p-clean","p-required","p-emit-object-value","p-change"],["formControlName","fornecedor","p-label","Fornecedor",1,"po-md-6",3,"p-filter-service","p-disabled","p-clean","p-required","p-emit-object-value","p-change"],["formControlName","tipoCompra","p-label","Tipo",1,"po-md-6",3,"p-filter-service","p-disabled","p-clean","p-required","p-emit-object-value"],["formControlName","descricao","p-label","Descri\xe7\xe3o",1,"po-md-12",3,"p-disabled"],["formControlName","dataCompra","p-label","Data da compra",1,"po-md-6",3,"p-disabled"],["formControlName","subgrupo","p-label","Subgrupo",1,"po-md-6",3,"p-filter-service","p-disabled","p-clean","p-required","p-emit-object-value","p-change"],["formControlName","mesInicioCobranca","p-label","M\xeas de in\xedcio da cobran\xe7a","p-mask","99","p-required","true",1,"po-md-6",3,"p-disabled","p-clean"],["formControlName","anoInicioCobranca","p-label","Ano de in\xedcio da cobran\xe7a","p-mask","2099","p-required","true",1,"po-md-6",3,"p-disabled","p-clean"],["class","po-row",4,"ngIf"],["formControlName","parcelas","p-label","Quantidade de Parcelas","p-required","true","p-mask","9999",1,"po-md-6",3,"p-disabled","p-clean"],["formControlName","valor","p-label","Valor total da Compra","p-required","true",1,"po-md-6",3,"p-disabled","p-clean"],[1,"po-md-12"],[2,"width","100%",3,"p-striped","p-items","p-columns","p-actions","p-actions-right"],["tabelaResponsavel",""],[1,"po-mt-1","po-mb-1","po-md-12"],["p-label","Incluir",3,"p-small","p-disabled","p-click"],[3,"responsaveis","atualizarFormulario"],["modalResponsavelCompra",""],["formControlName","aliquotaImposta","p-label","Al\xedquota imposta sobre a compra","p-clean","true","p-mask","999",1,"po-md-6",3,"p-disabled"],["formControlName","valorImposto","p-label","Valor imposto sobre a compra","p-clean","true","p-readonly","true",1,"po-md-6"]],template:function(r,o){1&r&&(e.TgZ(0,"po-page-default",0)(1,"po-container")(2,"form",1)(3,"div",2)(4,"po-combo",3),e.NdJ("p-change",function(l){return o.alteraBanco(l)}),e.qZA(),e.TgZ(5,"po-combo",4),e.NdJ("p-change",function(l){return o.alteraFornecedor(l)}),e.qZA()(),e._UZ(6,"po-combo",5),e.TgZ(7,"div",2),e._UZ(8,"po-textarea",6),e.qZA(),e.TgZ(9,"div",2),e._UZ(10,"po-datepicker",7),e.TgZ(11,"po-combo",8),e.NdJ("p-change",function(l){return o.alteraSubgrupo(l)}),e.qZA()(),e.TgZ(12,"div",2),e._UZ(13,"po-input",9)(14,"po-input",10),e.qZA(),e.YNc(15,D,3,1,"div",11),e.TgZ(16,"div",2),e._UZ(17,"po-input",12)(18,"po-decimal",13),e.qZA()(),e.TgZ(19,"div",2)(20,"div",14),e._UZ(21,"po-table",15,16),e.qZA()(),e.TgZ(23,"div",2)(24,"div",17)(25,"po-button",18),e.NdJ("p-click",function(){return o.abrirModalResponsavelCompra()}),e.qZA()()(),e._UZ(26,"br")(27,"br")(28,"br"),e.qZA()(),e.TgZ(29,"app-responsavel-compra",19,20),e.NdJ("atualizarFormulario",function(l){return o.atualizarFormulario(l)}),e.qZA()),2&r&&(e.Q6J("p-title",o.nomePagina)("p-breadcrumb",o.navegacao)("p-actions",o.acoes),e.xp6(2),e.Q6J("formGroup",o.formulario),e.xp6(2),e.Q6J("p-filter-service",o.bancoComboService)("p-disabled",o.somenteLeitura)("p-clean",!!o.somenteLeitura)("p-required",!0)("p-emit-object-value",!0),e.xp6(1),e.Q6J("p-filter-service",o.fornecedorComboService)("p-disabled",o.somenteLeitura)("p-clean",!!o.somenteLeitura)("p-required",!0)("p-emit-object-value",!0),e.xp6(1),e.Q6J("p-filter-service",o.tipoCompraEnumComboService)("p-disabled",o.somenteLeitura)("p-clean",!o.somenteLeitura)("p-required",!0)("p-emit-object-value",!0),e.xp6(2),e.Q6J("p-disabled",o.somenteLeitura),e.xp6(2),e.Q6J("p-disabled",o.somenteLeitura.toString()),e.xp6(1),e.Q6J("p-filter-service",o.subgrupoComboService)("p-disabled",o.somenteLeitura)("p-clean",!!o.somenteLeitura)("p-required",!0)("p-emit-object-value",!0),e.xp6(2),e.Q6J("p-disabled",o.somenteLeitura.toString())("p-clean",o.somenteLeitura?"true":"false"),e.xp6(1),e.Q6J("p-disabled",o.somenteLeitura.toString())("p-clean",o.somenteLeitura?"true":"false"),e.xp6(1),e.Q6J("ngIf","DINHEIRO"==o.bancoNome),e.xp6(2),e.Q6J("p-disabled",o.somenteLeitura.toString())("p-clean",o.somenteLeitura?"true":"false"),e.xp6(1),e.Q6J("p-disabled",o.somenteLeitura.toString())("p-clean",o.somenteLeitura?"true":"false"),e.xp6(3),e.Q6J("p-striped",!0)("p-items",o.formulario.controls.responsaveis.value)("p-columns",o.colunasResponsavelCompra)("p-actions",o.somenteLeitura?e.DdM(43,M):o.acoesLista)("p-actions-right",!0),e.xp6(4),e.Q6J("p-small",!0)("p-disabled",o.somenteLeitura),e.xp6(4),e.Q6J("responsaveis",o.formulario.controls.responsaveis.value))},dependencies:[b.O5,p.bOz,p.PJf,p.GWy,p.ZZR,p.dZS,p.xxV,p.gJm,p.MUI,p._w3,n._Y,n.JJ,n.JL,n.sg,n.u,Q],encapsulation:2})}return i})()}];let V=(()=>{class i{static#e=this.\u0275fac=function(r){return new(r||i)};static#a=this.\u0275mod=e.oAB({type:i});static#o=this.\u0275inj=e.cJS({imports:[u.Bz.forChild(z),u.Bz]})}return i})(),P=(()=>{class i{static#e=this.\u0275fac=function(r){return new(r||i)};static#a=this.\u0275mod=e.oAB({type:i});static#o=this.\u0275inj=e.cJS({imports:[b.ez,p.JBz,n.UX,n.u5,V]})}return i})()}}]);